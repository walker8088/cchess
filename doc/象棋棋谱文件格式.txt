注：2024.4.26晚上易乐子航整理于图书馆，来源于网络。 

1. 象棋桥棋谱的数据格式详解

（数据结构表格太长，暂不列出）

1.1象棋桥的棋谱

分为2种，一种是棋谱，扩展名是 .cbr ,另一种是棋谱组，扩展名是 .cbl

1.2象棋桥的象棋局面数据结构如下

	0字节 x*y=9*10 棋盘

  '  1 2 3 4 5 6 7 8 9  下面数字是16进制，上黑下红

  '1 00 01 02 03 04 05 06 07 08 21 22 23 24 25 24 23 22 21 黑棋

  '2 09 0A 0B 0C 0D 0E 0F 10 11 .. .. .. .. .. .. .. .. ..

  '3 12 13 14 15 16 17 18 19 1A .. 26 .. .. .. .. .. 26 ..

  '4 1B 1C 1D 1E 1F 20 21 22 23 27 .. 27 .. 27 .. 27 .. 27

  '5 24 25 26 27 28 29 2A 2B 2C .. .. .. .. .. .. .. .. ..

  '6 2D 2E 2F 30 31 32 33 34 35 .. .. .. .. .. .. .. .. ..

  '7 36 37 38 39 3A 3B 3C 3D 3E 17 .. 17 .. 17 .. 17 .. 17

  '8 3F 40 41 42 43 44 45 46 47 .. 16 .. .. .. .. .. 16 ..

  '9 48 49 4A 4B 4C 4D 4E 4F 50 .. .. .. .. .. .. .. .. ..

	  '10 51 52 53 54 55 56 57 58 59 11 12 13 14 15 14 13 12 11 红棋

 

1.3象棋桥棋谱着法数据

包括2个字节：BBAA   BB=起始坐标 AA=落子坐标。坐标 00-89 对应象棋局面数据结构的90字节。

1.4象棋桥棋谱里的变着

	为了记录变着，就把棋谱用4字节表示

AA BB CC DD

AA：01表示棋谱结束 02表示该步有分支 04表示该步有注解  （3种可以任意组合一起搭配使用）

BB：一般为零

CC：表示走棋的起始坐标

DD：表示走棋的落子坐标

遇到 AA 中包含2 就创建一个子变着

遇到 AA 中包含1 表示这个棋谱结束，如果上次记录到有子变着，那么后面棋谱就是子变着棋谱

遇到 AA 中包含4 ，那么其后面4个字节必然是注解文字的长度，读取长度，然后读取注解文字，接下来循环分析棋谱数据

直到遇到AA中包含1 而且没有子变着后，棋谱全部结束，退出循环。

所以，AA 是循环的和移动数据位置的关键。因此读出棋谱带变着的循环代码很简单

sp 是数据地址偏移

  Do

     棋谱标记 = 读字节数据(sp)

     棋谱变招 = 读字节数据(sp + 1)

     起始坐标 = 读字节数据(sp + 2)

     落子坐标 = 读字节数据(sp + 3)

     If (棋谱标记 And 4) = 4 Then

        sp            += 4

        注解长度      = 读4字节数据(sp + 3)

        sp += 4

        -----这里是读取注解记录到内存----

     Else

        sp += 4

     End If

     -----这里是读取 落子坐标 起始坐标 记录到内存----

     If (棋谱标记 And 2) = 2 Then '表示后头还有棋谱

        ----这里创建变着棋谱-------

     End If

     If (棋谱标记 And 1) = 1 Then '表示棋谱结束

        ----这里判断没变着棋谱就退出循环，有变着就继续到变着记录-------

     Else

        ----这里为下一个棋谱创建内存-------

     End If

	  Loop

 

 

2. YFK格式的开局库说明

2.1yfk是开局库

勇芳象棋软件中使用的开局库，其实是OBK开局库（兵河开局库）的改版，本质上和OBK是一样的。文件其实是 SQLite 标准数据库文件，可以用任意相关数据库管理软件打开。

2.2主表字段说明

基本上和OBK一样，只是取消了一个文字的字段，可以节约开局库大小。

· id

· vkey 64位整数，象棋局面哈希值，类似MD5的不可逆算法

· vmove 招法，16位整数，1个8位是开始走棋坐标，另一个8位是目标坐标（和OBK的8+8相反，勇芳象棋的来源是象棋百科全书网站，下载来的开源，象棋巫师，里面使用的招法数字，和OBK刚好相反。）

· vscore 招法评分

· vwin 赢的盘数

· vdraw 和的盘数

· vlost 输的盘数

· vvalid 另一个注解表的ID，用来显示注解。

· vindex 索引（一般记录的是开局步数），大多为空，没使用，可以用来排序

2.3vkey 的计算方法简介

红黑双方共14个棋子，棋盘有 9*10 格子有 90个。然后就有14*90 个数据，这数据是提前算好的64位哈希值。

 

 

3.OBK格式的开局库说明

3.1obk简介

OBK是“冰河五四”象棋软件中使用的开局库，还附带了开局库生成工具，由于当年象棋软件稀少，此软件带动了开局库发展，现如今绝大多数的开局库都是这个格式，而且非常多，开局库还经常更新。

3.2字段说明

· id

· vkey 64位整数，象棋局面哈希值，类似MD5的不可逆算法

· vmove 招法，16位整数，1个8位是开始走棋坐标，另一个8位是目标坐标

· vscore 招法评分

· vwin 赢的盘数

· vdraw 和的盘数

· vlost 输的盘数 

· vvalid 禁止或允许，1=允许 0=禁用

· vmemo 注解

· vindex 索引（一般记录的是开局步数），大多为空，没使用，可以用来排序

 

4. 东萍棋谱网格式

前面几篇介绍过FEN串，东萍棋谱采用了完全不同的方法来表示，直接用坐标表示法，先固定每个棋子的排序

	象棋子“车马相士帅士相马车炮炮兵兵兵兵兵车马象士将士象马车炮炮卒卒卒卒卒”的顺序

然后把每1个棋子的坐标按这个棋子的排序来替代，棋盘左上角为(0,0)，右下角为(8,9)，遇到得到以下数据

	8979695949392919097717866646260600102030405060708012720323436383

当这个棋子没在棋盘上，就是被吃掉的子，就用 “99”来表示，最后没有表示红先还是黑先，全部默认红走

  作者：易乐子航 https://www.bilibili.com/read/cv34130527/?jump_opus=1 出处：bilibili